
function main() {
  document.querySelector("#upda").innerHTML = ''
  //os.envitron['BITRIXTEST3']v4::
  auth = 'none_log'
  try {
    auth = process.env.BITRIXTEST
  } catch {
    del = 1
  }
  try {
    auth = config.BITRIXTEST
  } catch {
    del = 1
  }
  try {
    auth = $BITRIXTEST3
  } catch {
    del = 1
  }
  /*  try{auth = ${BITRIXTEST}}catch{del=1}
    try{auth = ${BITRIXTEST1}}catch{del=1}
    try{auth = ${BITRIXTEST2}}catch{del=1}
    try{auth = ${BITRIXTEST3}}catch{del=1}	
    console.log(auth)
    try{auth = ${{BITRIXTEST}}}catch{del=1}
    try{auth = ${{BITRIXTEST1}}}catch{del=1}
    try{auth = ${{BITRIXTEST2}}}catch{del=1}
    try{auth = ${{BITRIXTEST3}}}catch{del=1}	*/
  table.style = 'display:block'

  table1.style = 'display:none'
  searchbar.focus()
  //searches.value = 'TITLE'
}
  //searches.value = 'TITLE'
  //searchbar.value = 'funeral'
  function search() {
    while (table.childNodes.length > 4) {
      table.removeChild(table.lastChild)
    }
    displayed.innerHTML = 'Results: 0'
    var selection = searches.value
    const searched = searchbar.value
    try {
      var auth_code = process.env.BITRIXTEST
    } catch {
    [][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]][([][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+[]]]+([][[]]+[])[+!+[]]+(![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+[]]+([][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+[]]]+(!![]+[])[+!+[]]]([][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]][([][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+[]]]+([][[]]+[])[+!+[]]+(![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+[]]+([][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+[]]]+(!![]+[])[+!+[]]]((!![]+[])[+!+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+!+[]]+([]+[])[(![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+[]]]+([][[]]+[])[+!+[]]+(!![]+[])[+[]]+([][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+[]]]+(!![]+[])[+!+[]]]()[+!+[]+[!+[]+!+[]]]+((![]+[])[+!+[]]+(!![]+[])[+[]]+[!+[]+!+[]+!+[]+!+[]+!+[]+!+[]+!+[]]+[!+[]+!+[]+!+[]+!+[]+!+[]]+(!![]+[])[+[]]+[!+[]+!+[]+!+[]+!+[]]+[!+[]+!+[]]+(!![]+[])[+[]]+[+!+[]]+[+!+[]]+[!+[]+!+[]+!+[]+!+[]+!+[]+!+[]+!+[]]+(!![]+[])[+[]]+[+!+[]]+[+!+[]]+[+[]]+(!![]+[])[+[]]+[+!+[]]+[+!+[]]+[!+[]+!+[]]+[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+[+!+[]]+[!+[]+!+[]+!+[]+!+[]]+[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+[+!+[]]+[!+[]+!+[]+!+[]+!+[]+!+[]]+[!+[]+!+[]]+(!![]+[])[+[]]+[+!+[]]+[+[]]+[!+[]+!+[]+!+[]+!+[]+!+[]+!+[]]+[!+[]+!+[]]+(!![]+[])[+[]]+[+!+[]]+[!+[]+!+[]+!+[]+!+[]]+[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+[+!+[]]+[!+[]+!+[]+!+[]+!+[]+!+[]]+[!+[]+!+[]+!+[]+!+[]+!+[]]+(!![]+[])[+[]]+[+!+[]]+[!+[]+!+[]+!+[]+!+[]+!+[]+!+[]+!+[]]+[+[]]+(!![]+[])[+[]]+[+!+[]]+[!+[]+!+[]+!+[]+!+[]+!+[]]+[!+[]+!+[]+!+[]+!+[]+!+[]]+(+[![]]+[])[+[]]+(!![]+[])[+[]]+[+!+[]]+[+[]]+[!+[]+!+[]+!+[]+!+[]+!+[]+!+[]+!+[]]+(!![]+[])[+[]]+[+!+[]]+[!+[]+!+[]+!+[]+!+[]+!+[]+!+[]]+[!+[]+!+[]+!+[]+!+[]]+(!![]+[])[+!+[]]+(!![]+[])[+[]]+[+!+[]]+[!+[]+!+[]+!+[]]+[!+[]+!+[]]+(!![]+[])[+[]]+[+!+[]]+[!+[]+!+[]+!+[]+!+[]+!+[]]+[!+[]+!+[]]+(+[![]]+[])[+[]]+(!![]+[])[+[]]+[+!+[]]+[!+[]+!+[]+!+[]+!+[]+!+[]]+[!+[]+!+[]]+(!![]+[])[+[]]+[+!+[]]+[!+[]+!+[]+!+[]]+[!+[]+!+[]]+(!![]+[])[+[]]+[+!+[]]+[!+[]+!+[]]+[+!+[]]+(!![]+[])[+[]]+[!+[]+!+[]+!+[]+!+[]]+[!+[]+!+[]])[(![]+[])[!+[]+!+[]+!+[]]+(+(!+[]+!+[]+[+!+[]]+[+!+[]]))[(!![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+[]]]+([]+[])[([][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+[]]]+([][[]]+[])[+!+[]]+(![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+[]]+([][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+[]]]+(!![]+[])[+!+[]]][([][[]]+[])[+!+[]]+(![]+[])[+!+[]]+((+[])[([][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+[]]]+([][[]]+[])[+!+[]]+(![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+[]]+([][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+[]]]+(!![]+[])[+!+[]]]+[])[+!+[]+[+!+[]]]+(!![]+[])[!+[]+!+[]+!+[]]]](!+[]+!+[]+!+[]+[+!+[]])[+!+[]]+(![]+[])[!+[]+!+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(!![]+[])[+[]]]((!![]+[])[+[]])[([][(!![]+[])[!+[]+!+[]+!+[]]+([][[]]+[])[+!+[]]+(!![]+[])[+[]]+(!![]+[])[+!+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(!![]+[])[!+[]+!+[]+!+[]]+(![]+[])[!+[]+!+[]+!+[]]]()+[])[!+[]+!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+[]]]+([![]]+[][[]])[+!+[]+[+[]]]+([][[]]+[])[+!+[]]](([][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]][([][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+[]]]+([][[]]+[])[+!+[]]+(![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+[]]+([][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+[]]]+(!![]+[])[+!+[]]]((!![]+[])[+!+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+!+[]]+(![]+[+[]])[([![]]+[][[]])[+!+[]+[+[]]]+(!![]+[])[+[]]+(![]+[])[+!+[]]+(![]+[])[!+[]+!+[]]+([![]]+[][[]])[+!+[]+[+[]]]+([][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]]+[])[!+[]+!+[]+!+[]]+(![]+[])[!+[]+!+[]+!+[]]]()[+!+[]+[+[]]]+![]+(![]+[+[]])[([![]]+[][[]])[+!+[]+[+[]]]+(!![]+[])[+[]]+(![]+[])[+!+[]]+(![]+[])[!+[]+!+[]]+([![]]+[][[]])[+!+[]+[+[]]]+([][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]]+[])[!+[]+!+[]+!+[]]+(![]+[])[!+[]+!+[]+!+[]]]()[+!+[]+[+[]]])()[([][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+[]]]+([][[]]+[])[+!+[]]+(![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+[]]+([][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+[]]]+(!![]+[])[+!+[]]]((![]+[+[]])[([![]]+[][[]])[+!+[]+[+[]]]+(!![]+[])[+[]]+(![]+[])[+!+[]]+(![]+[])[!+[]+!+[]]+([![]]+[][[]])[+!+[]+[+[]]]+([][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]]+[])[!+[]+!+[]+!+[]]+(![]+[])[!+[]+!+[]+!+[]]]()[+!+[]+[+[]]])+[])[+!+[]])+([]+[])[(![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+[]]]+([][[]]+[])[+!+[]]+(!![]+[])[+[]]+([][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+[]]]+(!![]+[])[+!+[]]]()[+!+[]+[!+[]+!+[]]])())()
    }
    if (selection == 'em1pty') {
      err.innerHTML = 'Field must not be blank'
    } else if (searched == '') {
      err.innerHTML = 'Search Query must not be blank'
    } else {
      //Search is valid
      err.innerHTML = ''
      //var baseURL = "https://simplebiz.bitrix24.com/rest/168/" + atob(a) + "/crm.deal.list.json?SELECT[]=TITLE&SELECT[]=STAGE_ID&SELECT[]=UF_CRM_1647620775586&SELECT[]=UF_CRM_1647620757299&SELECT[]=UF_CRM_1647619374742&SELECT[]=UF_CRM_1647620698387&SELECT[]=UF_CRM_1647620715972&SELECT[]=UF_CRM_1681248068566&SELECT[]=UF_CRM_1647653820587&SELECT[]=UF_CRM_1647616629267&SELECT[]=UF_CRM_1680303047490&SELECT[]=UF_CRM_1680303451526&SELECT[]=UF_CRM_1680294914005"
      
      selects="SELECT[]=TITLE&SELECT[]=STAGE_ID&SELECT[]=UF_CRM_1647620775586&SELECT[]=UF_CRM_1647620757299&SELECT[]=UF_CRM_1647619374742&SELECT[]=UF_CRM_1647620698387&SELECT[]=UF_CRM_1647620715972&SELECT[]=UF_CRM_1681248068566&SELECT[]=UF_CRM_1647653820587&SELECT[]=UF_CRM_1647616629267&SELECT[]=UF_CRM_1680303047490&SELECT[]=UF_CRM_1680303451526&SELECT[]=UF_CRM_1680294914005".replaceAll("&","%26")
      //business name
      try{
      	cmd0 = selects+'%26filter[%TITLE]='+searched
      }catch{cmd0=''}			
      //URL's
      try{
				cmd1 = selects+"%26filter[%UF_CRM_1647620775586]=" + searched.match(/(((?<=https\:\/\/www\.)|(?<=http\:\/\/www\.)|(?<=www\.)|(?<=https\:\/\/(?!www))|(?<=http\:\/\/(?!www))).*(?<!\/))|^(?!(http|www))(.*(?<!\/))/)[0]
      }catch{cmd1=''}
      try{
      	cmd2 = selects+"%26filter[%UF_CRM_1647620757299]=" + searched.match(/(((?<=https\:\/\/www\.)|(?<=http\:\/\/www\.)|(?<=www\.)|(?<=https\:\/\/(?!www))|(?<=http\:\/\/(?!www))).*(?<!\/))|^(?!(http|www))(.*(?<!\/))/)[0]
      }catch{cmd2=''}
      //phone number
      try{
        rawNumber = searched.match(/\(?[0-9]{3}(\.|\-|\)|\ )*?[0-9]{3}(\.|\-|\)|\ )*?[0-9]{4}/)[0].match(/[0-9]/g)
        rawNumberArr = []
        rawNumberArr.push(rawNumber.slice(0, 3).join(''))
        rawNumberArr.push(rawNumber.slice(3, 6).join(''))
        rawNumberArr.push(rawNumber.slice(6, 10).join(''))
        selection = 'UF_CRM_1647620698387'
        baseURL = ''
        baseURL += "&filter[%" + selection + "][0]=" + "(" + rawNumberArr[0] + ")-" + rawNumberArr[1] + '-' + rawNumberArr[2]
        baseURL += "&filter[%" + selection + "][1]=" + "(" + rawNumberArr[0] + ")" + rawNumberArr[1] + '-' + rawNumberArr[2]
        baseURL += "&filter[%" + selection + "][2]=" + "(" + rawNumberArr[0] + ") " + rawNumberArr[1] + '-' + rawNumberArr[2]
        baseURL += "&filter[%" + selection + "][3]=" + "(" + rawNumberArr[0] + ")" + rawNumberArr[1] + rawNumberArr[2]
        baseURL += "&filter[%" + selection + "][4]=" + "(" + rawNumberArr[0] + ") " + rawNumberArr[1] + ' ' + rawNumberArr[2]
        baseURL += "&filter[%" + selection + "][5]=" + "(" + rawNumberArr[0] + ")" + rawNumberArr[1] + ' ' + rawNumberArr[2]
        baseURL += "&filter[%" + selection + "][6]=" + rawNumberArr[0] + "." + rawNumberArr[1] + '.' + rawNumberArr[2]
        baseURL += "&filter[%" + selection + "][7]=" + rawNumberArr[0] + " " + rawNumberArr[1] + ' ' + rawNumberArr[2]
        baseURL += "&filter[%" + selection + "][8]=" + rawNumberArr[0] + "-" + rawNumberArr[1] + '-' + rawNumberArr[2]
        baseURL += "&filter[%" + selection + "][9]=" + rawNumberArr[0] + rawNumberArr[1] + rawNumberArr[2]
        cmd3 = selects+baseURL.replaceAll('&',"%26")
      }catch{cmd3=''}
      //owner
      try{
      	cmd4 = selects+'%26filter[%UF_CRM_1647619374742]='+searched
      }catch{cmd4=''}
			try{
      	cmd5 = selects+'%26filter[%UF_CRM_1647620715972]='+searched
      }catch{cmd5=''}

      //console.log(cmd0)
      
      url = ''
      url = "https://simplebiz.bitrix24.com/rest/168/" + atob(a) + "/batch.json?halt=0"
      if(cmd0!=''){url+='&cmd[0]=crm.deal.list?'+cmd0}
			if(cmd1!=''){url+='&cmd[1]=crm.deal.list?'+cmd1}
      if(cmd2!=''){url+='&cmd[2]=crm.deal.list?'+cmd2}
      if(cmd3!=''){url+='&cmd[3]=crm.deal.list?'+cmd3}
      if(cmd4!=''){url+='&cmd[4]=crm.deal.list?'+cmd4}
      if(cmd5!=''){url+='&cmd[5]=crm.deal.list?'+cmd4}
      
      console.log(url)
      $.when(
        $.ajax(
          url, {
            method: "GET",
            success: function(data) {
              //document.body.innerHTML = data.result;
              /* console.log(data.result); выведет "Текст" */
              results1 = data.result
              //console.log('logS')
//              console.log(Object.keys(results['result']).length)
              keys = Object.keys(results1['result_total']) 
              //console.log(results1['result_total'])
              //console.log(keys)
              total_logs = []
              origin = {}
              //console.log(results1)
              results = []
              for(var i=0;i<keys.length;i++){
              //console.log(results1['result_total'][keys[i]])
              	if(results1['result_total'][keys[i]]!=0){
                //console.log('loop #1 '+String(keys[i]))
                	//console.log(results1['result'][keys[i]])
                  //console.log('loop #1 [2]')
                 //console.log(results1['result_total'][keys[i]])
                	for(var j = 0;j<results1['result'][keys[i]].length;j++){
                  
                  	if (!total_logs.includes(results1['result'][keys[i]][j].ID)){
                    	total_logs.push(results1['result'][keys[i]][j].ID)
                      results.push(results1['result'][keys[i]][j])
                      origin[results1['result'][keys[i]][j].TITLE] = keys[i]
                    }
                  }

                }
              }
              console.log(origin)
               //console.log(total_logs)
              //console.log(results)
               //console.log('logE')
            }
          }
        )
      ).then(function() {
        if (results.length == 0) {
          err.innerHTML = 'No results returned'
        } else {
          //Results came back
          console.log(results.length)
          for (var i = 0; i < results.length; i++) {
            var tr = document.createElement('tr')
            var td = document.createElement('td')
            var p = document.createElement('p')
            var td1 = document.createElement('td')
            var td2 = document.createElement('td')
            var p2 = document.createElement('p')

            switch (results[i].STAGE_ID) {
              case "UC_UWG2Z6":
                stage_name = 'Accounting'
                color = '#00bdb5'
                break
              case "NEW":
                stage_name = 'New Project - Check Keywords'
                color = '#fff2cc'
                break
              case "PREPARATION":
                stage_name = 'Ready to Assign'
                color = '#fff2cc'
                break
              case "PREPAYMENT_INVOICE":
                stage_name = 'Assigned to Developer'
                color = '#fff2cc'
                break
              case "EXECUTING":
                stage_name = 'Under Construction - Work Has Begun'
                color = '#fff300'
                break
              case "UC_E7D3K7":
                stage_name = 'Waiting on Green Screen'
                color = '#f0009c'
                break
              case "UC_CKBLB0":
                stage_name = 'Collaboration'
                color = '#f99500'
                break
              case "FINAL_INVOICE":
                stage_name = 'Review 1 - Proofreader'
                color = '#578520'
                break
              case "UC_DNHMU6":
                stage_name = 'Review 2 - Dev Lead'
                color = '#abd46c'
                break
              case "1":
                stage_name = 'Review 3 - Senior Lead'
                color = '#0052a7'
                break
              case "2":
                stage_name = 'Review 4 - Final Inspection & Delivery'
                color = '#662793'
                break
              case "3":
                stage_name = 'Delivered'
                color = '#10e5fc'
                break
              case "UC_YNZ0TE":
                stage_name = 'Accounting Hold'
                color = '#ef3000'
                break
              case "UC_T514VC":
                stage_name = 'Canceled Deal'
                color = '#949da9'
                break
              case "LOSE":
                stage_name = 'Closed (Moved to Blues Board)'
                color = '#949da9'
                break
            }
            //console.log(color)
            td1.width = "15px"
            td1.bgColor = color
            switch (origin[results[i].TITLE]){
              case "0":
                p2.innerHTML = 'Business Name'
                break            
            	case "1":
              	p2.innerHTML = 'New Main URL'
                break
              case "2":
              	p2.innerHTML = 'Legacy URL'
                break
              case "3":
              	p2.innerHTML = 'Phone Number'
                break
              case "4":
                p2.innerHTML = 'Owner'
                break
              case "5": 
              	p2.innerHTML = 'Email'

            }

            p.innerHTML = results[i].TITLE
            p.addEventListener("click", show, false)
            p.param = i
            td2.width='93px'
            td.width='256px'
            td.appendChild(p)
            tr.appendChild(td1)
            tr.appendChild(td)
            td2.appendChild(p2)
            tr.appendChild(td2)
            table.appendChild(tr)
          }
          displayed.innerHTML = 'Results: ' + String(results.length)
        }
      })
    }
  }


function reviews_() {
  $.when(
    $.ajax(
      'https://docs.google.com/spreadsheets/d/19_5VjsLHcp9gCOZd4M7QqWJhm8lMU28j6Y15sFRzVn8/gviz/tq?tqx=out:html&tq&gid=1426942431', {
        method: "GET",
        success: function(data) {
          //console.log(data); /* выведет "Текст" */
          lookuptablereviews.innerHTML = data
          var tryagainst = document.getElementById('TITLE').innerHTML
          var trs = document.getElementsByTagName('tr')

          for (var i = 0; i < trs.length; i++) {
            try {
              if (trs[i].children[3].innerHTML.trim().includes(tryagainst.trim()) || tryagainst.trim().includes(trs[i].children[3].innerHTML.trim())) {
                if (trs[i].children[2].innerHTML == '5') {
                  if (trs[i].children[0].innerHTML == 'S') {
                    document.getElementById('sjr').innerHTML = 'Sitejabber Review Claimed'
                  }
                  if (trs[i].children[0].innerHTML == 'T') {
                    document.getElementById('tpr').innerHTML = 'Trustpilot Review Claimed'
                  }
                }
              }
            } catch {
              continue
            }
          }
          if (document.getElementById('sjr').innerHTML == 'Loading...') {
            document.getElementById('sjr').innerHTML = 'Sitejabber Review NOT Claimed'
          }
          if (document.getElementById('tpr').innerHTML == 'Loading...') {
            document.getElementById('tpr').innerHTML = 'Trustpilot Review NOT Claimed'
          }

        }
      }
    )
  ).then(function() {

    return
  })

}

function show(indexCover) {
  document.getElementById('sjr').innerHTML = 'Loading...'
  document.getElementById('tpr').innerHTML = 'Loading...'
  index = indexCover.currentTarget.param
  table.style = 'display:none'
  table1.style = 'display:block'
  ID_.innerHTML = results[index].ID
  stage_name = 'unknown'
  switch (results[index].STAGE_ID) {
    case "UC_UWG2Z6":
      stage_name = 'Accounting'
      break
    case "NEW":
      stage_name = 'New Project - Check Keywords'
      break
    case "PREPARATION":
      stage_name = 'Ready to Assign'
      break
    case "PREPAYMENT_INVOICE":
      stage_name = 'Assigned to Developer'
      break
    case "EXECUTING":
      stage_name = 'Under Construction - Work Has Begun'
      break
    case "UC_E7D3K7":
      stage_name = 'Waiting on Green Screen'
      break
    case "UC_CKBLB0":
      stage_name = 'Collaboration'
      break
    case "FINAL_INVOICE":
      stage_name = 'Review 1 - Proofreader'
      break
    case "UC_DNHMU6":
      stage_name = 'Review 2 - Dev Lead'
      break
    case "1":
      stage_name = 'Review 3 - Senior Lead'
      break
    case "2":
      stage_name = 'Review 4 - Final Inspection & Delivery'
      break
    case "3":
      stage_name = 'Delivered'
      break
    case "UC_YNZ0TE":
      stage_name = 'Accounting Hold'
      break
    case "UC_T514VC":
      stage_name = 'Canceled Deal'
      break
    case "LOSE":
      stage_name = 'Closed (Moved to Blues Board)'
      break
  }

  STAGE_ID.innerHTML = stage_name
  TITLE.innerHTML = results[index].TITLE
  UF_CRM_1647616629267.innerHTML = results[index].UF_CRM_1647616629267
  UF_CRM_1647619374742.innerHTML = results[index].UF_CRM_1647619374742
  UF_CRM_1647620698387.innerHTML = results[index].UF_CRM_1647620698387
  UF_CRM_1647620715972.innerHTML = results[index].UF_CRM_1647620715972
  UF_CRM_1647620757299.innerHTML = results[index].UF_CRM_1647620757299
  UF_CRM_1647620775586.innerHTML = results[index].UF_CRM_1647620775586
  UF_CRM_1647653820587.innerHTML = results[index].UF_CRM_1647653820587
  UF_CRM_1680294914005.innerHTML = results[index].UF_CRM_1680294914005
  UF_CRM_1680303047490.innerHTML = results[index].UF_CRM_1680303047490
  UF_CRM_1680303451526.innerHTML = results[index].UF_CRM_1680303451526
  UF_CRM_1681248068566.innerHTML = results[index].UF_CRM_1681248068566
  ButtonBitrix.href = 'https://simplebiz.bitrix24.com/crm/deal/details/' + results[index].ID + '/'
  ButtonBack.addEventListener('click', main)
  reviews_()

}
searchbar.addEventListener('keypress', function(e) {
  if (e.key === 'Enter') {
    searchB.click()
  }
})
searchB.addEventListener('click', search)
main()
